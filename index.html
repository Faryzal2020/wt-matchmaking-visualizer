<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8">
	<link rel="stylesheet" href="css/bootstrap.css">
	<link rel="stylesheet" href="css/css.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.js"></script>
	<script type="text/javascript" src="js/tanksDB.js"></script>
</head>
<body>
	<button class="btn btn-default disabled" id="flipBtn" style="display: none">Transpose</button>
	<div class="table-container" id="table-container">
	</div>
</body>
	<script type="text/javascript">
		$(document).ready(function() {
			var tblContainer = document.getElementById("table-container");
		    data.forEach(function(nation){
		    	console.log(nation);
		    	var table = document.createElement("table");
		    	table.className = "table table-bordered";
		    	table.id = nation.name+"table";

		    	var maxCol = 1;
		    	for(var brs in nation.br){
		    		if(nation.br.hasOwnProperty(brs)){
		    			var br = brs;
		    			var tanks = nation.br[brs];
		    			if(tanks.length > maxCol){
		    				maxCol = tanks.length;
		    			}
		    		}
		    	}
		    	maxCol=maxCol+1;
		    	var tr = document.createElement("tr");
		    	var th = document.createElement("th");
		    	var t = document.createTextNode(nation.name);
		    	var header = document.createElement("h2");
		    	th.id = nation.name+"header";
		    	th.colSpan = 100;
		    	header.appendChild(t);
		    	th.appendChild(header);
		    	tr.appendChild(th);
		    	table.appendChild(tr);

		    	for(var brs in nation.br){
		    		if(nation.br.hasOwnProperty(brs)){
		    			var br = brs;
		    			var tanks = nation.br[brs];

		    			var tr = document.createElement("tr");
		    			var td = document.createElement("td");
		    			var span = document.createElement("span");
		    			var t = document.createTextNode(br);
		    			span.appendChild(t);
		    			td.appendChild(span);
		    			tr.appendChild(td);
		    			brs = brs.replace(".","-");
		    			tr.id = nation.name+brs;
		    			tr.className = "BRrows "+brs;

		    			for (var i = 0; i < maxCol-1; i++) {
		    				if(i<tanks.length){
				    			td = document.createElement("td");
				    			span = document.createElement("span");
				    			t = document.createTextNode(tanks[i].tankname);
				    			td.id = tanks[i].code;
				    			td.className = "tankcell "+tanks[i].label;
			    				span.appendChild(t);
			    				td.appendChild(span);
			    				tr.appendChild(td);
		    				} else {
		    					td = document.createElement("td");
		    					tr.appendChild(td);
		    				}
		    			}
		    			table.appendChild(tr);
		    		}
		    	}
		    	tblContainer.appendChild(table);
		    });

		    $("#flipBtn").click(function(){
			    $(".table").each(function() {
			        var $this = $(this);
			        var newrows = [];
			        $this.find("tr").each(function(){
			            var i = 0;
			        	$(this).find("th").each(function(){
			        		if(newrows[i] === undefined) { newrows[i] = $("<tr></tr>"); }
			        		newrows[i].append($(this));
			        	});
			            $(this).find("td").each(function(){
			                i++;
			                if(newrows[i] === undefined) { newrows[i] = $("<tr></tr>"); }
			                newrows[i].append($(this));
			            });
			        });
			        $this.find("tr").remove();
			        $.each(newrows, function(){
			            $this.append(this);
			        });
			    });
			    
			    return false;
			});

			$(".table").delegate('td','mouseover mouseout', function(e) {
				$("tr").each(function(){
					$(this).removeClass("hover");
					$(this).removeClass("hover1");
					$(this).removeClass("hover2");
					$(this).removeClass("hover3");
					$(this).removeClass("hover4");
				});
				if (e.type == 'mouseover') {
					if(!$(this).parent().prev().prev().prev().children().is("th")){
						$(this).parent().prev().prev().prev().addClass("hover1");
					}
					if(!$(this).parent().prev().prev().children().is("th")){
						$(this).parent().prev().prev().addClass("hover2");
					}
					if(!$(this).parent().prev().children().is("th")){
						$(this).parent().prev().addClass("hover");
					}
					$(this).parent().addClass("hover");
					$(this).parent().next().addClass("hover");
					$(this).parent().next().next().addClass("hover3");
					$(this).parent().next().next().next().addClass("hover4");

					var rowclassname = $(this).parent().prop('className')
					var brnumber = rowclassname.split(' ')[1]
					$("."+brnumber).each(function(){
						if(!$(this).prev().prev().prev().children().is("th")){
							$(this).prev().prev().prev().addClass("hover1");
						}
						if(!$(this).prev().prev().children().is("th")){
							$(this).prev().prev().addClass("hover2");
						}
						if(!$(this).prev().children().is("th")){
							$(this).prev().addClass("hover");
						}
						$(this).addClass("hover");
						$(this).next().addClass("hover");
						$(this).next().next().addClass("hover3");
						$(this).next().next().next().addClass("hover4");
					});
				}
			});

			$(".BRrows").click(function(){
				console.log("test");
				var selected = $(this).hasClass("active");
			    $(".BRrows").removeClass("active");
			    if(!selected){
	            	$(this).addClass("active");
	            	var rowclassname = $(this).prop('className')
					var brnumber = rowclassname.split(' ')[1]
					$("."+brnumber).each(function(){
						$(this).addClass("active");
					});
			    }
			});
		});
	</script>
</html>